{% extends 'base.html' %}

{% block title %}é€šçŸ¥ä¸€è¦§{% endblock %}

{% block contents %}
<div class="container mt-4">
    <h2 class="mb-4">ğŸ”” é€šçŸ¥ä¸€è¦§</h2>
    {% if object_list %}
        <!-- ä¸€æ‹¬å‰Šé™¤ãƒ•ã‚©ãƒ¼ãƒ  -->
        <form method="post" action="{% url 'notification:notification_bulk_delete' %}" id="bulkDeleteForm">
            {% csrf_token %}
            <ul class="list-group">
                {% for obj in object_list %}
                    <li class="list-group-item d-flex justify-content-between align-items-center {% if not obj.is_read %}list-group-item-warning{% endif %}">
                        <div class="d-flex align-items-center">
                            <!-- ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ -->
                            <input type="checkbox" name="selected_notifications" value="{{ obj.pk }}" class="form-check-input me-2">

                            <!-- æ—¢èª­ãƒ»æœªèª­è¡¨ç¤º -->
                            {% if not obj.is_read %}
                                <span class="badge bg-danger me-2">æœªèª­</span>
                            {% else %}
                                <span class="badge bg-secondary me-2">æ—¢èª­</span>
                            {% endif %}

                            <!-- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
                            <span>{{ obj.message }}</span>

                            <!-- è©³ç´°ãƒªãƒ³ã‚¯ -->
                            {% if obj.url %}
                                <a href="{% url 'notification:notification_redirect' obj.pk %}" class="btn btn-primary btn-sm ms-2">è©³ç´°ã¸</a>
                            {% endif %}
                        </div>

                        <div class="d-flex align-items-center">
                            <!-- ä½œæˆæ—¥æ™‚ -->
                            <span class="text-muted me-3">{{ obj.created_at|date:"Y-m-d H:i"}}</span>

                            <!-- å€‹åˆ¥å‰Šé™¤ãƒœã‚¿ãƒ³ -->
                            <button type="submit" formaction="{% url 'notification:notification_delete' obj.pk %}" 
                                    class="btn btn-sm btn-outline-danger deleteBtn">
                                å‰Šé™¤
                            </button>
                        </div>
                    </li>
                {% endfor %}
            </ul>

            <!-- ä¸€æ‹¬å‰Šé™¤ãƒœã‚¿ãƒ³ -->
            <div class="mt-3">
                <button type="submit" class="btn btn-danger">é¸æŠã—ãŸé€šçŸ¥ã‚’å‰Šé™¤</button>
            </div>
        </form>

        <!-- ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ -->
        <div class="mt-3">
            {% if is_paginated %}
                <nav>
                    <ul class="pagination">
                        {% if page_obj.has_previous %}
                            <li class="page-item"><a href="?page={{ page_obj.previous_page_number }}" class="page-link">å‰ã¸</a></li>
                        {% endif %}
                        <li class="page-item disabled">
                            <span class="page-link">ãƒšãƒ¼ã‚¸ {{ page_obj.number }} / {{ page_obj.paginator.num_pages }}</span>
                        </li>
                        {% if page_obj.has_next %}
                            <li class="page-item"><a href="?page={{ page_obj.next_page_number }}" class="page-link">æ¬¡ã¸</a></li>
                        {% endif %}
                    </ul> 
                </nav>
            {% endif %}
        </div>
    {% else %}
        é€šçŸ¥ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
    {% endif %}
</div>

<!-- JS ã§ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚° -->
<script>
    // å€‹åˆ¥å‰Šé™¤ç¢ºèª
    document.querySelectorAll(".deleteBtn").forEach(btn => {
        btn.addEventListener("click", function(e) {
            if (!confirm("ã“ã®é€šçŸ¥ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")) {
                e.preventDefault();
            }
        });
    });

    // ä¸€æ‹¬å‰Šé™¤ç¢ºèª
    document.getElementById("bulkDeleteForm").addEventListener("submit", function(e) {
        if (e.submitter && e.submitter.classList.contains("deleteBtn")) {
            // å€‹åˆ¥å‰Šé™¤ã¯ã“ã“ã§å‡¦ç†ã•ã‚Œã‚‹ã®ã§ã‚¹ãƒ«ãƒ¼
            return;
        }
        if (!confirm("é¸æŠã—ãŸé€šçŸ¥ã‚’ã¾ã¨ã‚ã¦å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")) {
            e.preventDefault();
        }
    });
</script>
{% endblock %}
